{"version":3,"file":"index-376871b4.js","sources":["../../src/util/asserters.ts","../../src/util/constants.ts","../../src/components/ErrorBoundaryCard.tsx","../../src/components/Input.styled.tsx","../../src/components/FormInput.tsx","../../src/components/FormPreview.tsx","../../src/index.ts"],"sourcesContent":["import {type InputProps, isObjectInputProps, type PreviewLayoutKey, type PreviewProps} from 'sanity'\n\nimport type {MuxInputPreviewProps, MuxInputProps} from './types'\n\nexport function isMuxInputProps(props: InputProps): props is MuxInputProps {\n  return isObjectInputProps(props) && props.schemaType.type?.name === 'mux.video'\n}\n\nexport function isMuxInputPreviewProps(\n  props: PreviewProps<PreviewLayoutKey>\n): props is MuxInputPreviewProps {\n  return props.schemaType?.type?.name === 'mux.video'\n}\n","export const name = 'mux-input' as const\n\n// Caching namespace, as suspend-react might be in use by other components on the page we must ensure we don't collide\nexport const cacheNs = 'sanity-plugin-mux-input' as const\n\nexport const muxSecretsDocumentId = 'secrets.mux' as const\n","/* eslint-disable no-console */\nimport {Button, Card, Flex, Grid, Heading, Inline, Text, useToast} from '@sanity/ui'\nimport React, {memo, useCallback, useRef} from 'react'\nimport scrollIntoView from 'scroll-into-view-if-needed'\nimport {clear} from 'suspend-react'\nimport {useErrorBoundary} from 'use-error-boundary'\n\nimport {name} from '../util/constants'\nimport {type MuxInputProps} from '../util/types'\n\nexport interface Props extends Pick<MuxInputProps, 'schemaType'> {\n  children: React.ReactNode\n}\nfunction ErrorBoundaryCard(props: Props) {\n  const {children, schemaType} = props\n  const {push: pushToast} = useToast()\n  const errorRef = useRef(null)\n  const {ErrorBoundary, didCatch, error, reset} = useErrorBoundary({\n    onDidCatch: (err, errorInfo) => {\n      console.group(err.toString())\n      console.groupCollapsed('console.error')\n      console.error(err)\n      console.groupEnd()\n      if (err.stack) {\n        console.groupCollapsed('error.stack')\n        console.log(err.stack)\n        console.groupEnd()\n      }\n      if (errorInfo?.componentStack) {\n        console.groupCollapsed('errorInfo.componentStack')\n        console.log(errorInfo.componentStack)\n        console.groupEnd()\n      }\n      console.groupEnd()\n      pushToast({\n        status: 'error',\n        title: 'Plugin crashed',\n        description: (\n          <Flex align=\"center\">\n            <Inline space={1}>\n              An error happened while rendering\n              <Button\n                padding={1}\n                fontSize={1}\n                style={{transform: 'translateY(1px)'}}\n                mode=\"ghost\"\n                text={schemaType.title}\n                onClick={() => {\n                  if (errorRef.current) {\n                    scrollIntoView(errorRef.current, {\n                      behavior: 'smooth',\n                      scrollMode: 'if-needed',\n                      block: 'center',\n                    })\n                  }\n                }}\n              />\n            </Inline>\n          </Flex>\n        ),\n      })\n    },\n  })\n  const handleRetry = useCallback(() => {\n    // Purge request cache before retrying, otherwise the cached errors will rethrow\n    clear([name])\n\n    reset()\n  }, [reset])\n\n  if (didCatch) {\n    return (\n      <Card ref={errorRef} paddingX={[2, 3, 4, 4]} height=\"fill\" shadow={1} overflow=\"auto\">\n        <Flex justify=\"flex-start\" align=\"center\" height=\"fill\">\n          <Grid columns={1} gap={[2, 3, 4, 4]}>\n            <Heading as=\"h1\">\n              The <code>{name}</code> plugin crashed\n            </Heading>\n            {error?.message && (\n              <Card padding={3} tone=\"critical\" shadow={1} radius={2}>\n                <Text>{error.message}</Text>\n              </Card>\n            )}\n            <Inline>\n              <Button onClick={handleRetry} text=\"Retry\" />\n            </Inline>\n          </Grid>\n        </Flex>\n      </Card>\n    )\n  }\n\n  return <ErrorBoundary>{children}</ErrorBoundary>\n}\n\nexport default memo(ErrorBoundaryCard)\n","import {Box, Card, Flex, Spinner, Text} from '@sanity/ui'\nimport React from 'react'\nimport styled from 'styled-components'\n\n// This container base container ensures everything uses the same aspect ratio, avoids layout shifts and stuff jumping around\nexport const AspectRatioCard = styled(Card)`\n  aspect-ratio: 16 / 9;\n  position: relative;\n  width: 100%;\n`\n\nexport const InputFallback = () => {\n  return (\n    <div style={{padding: 1}}>\n      <Card\n        shadow={1}\n        sizing=\"border\"\n        style={{aspectRatio: '16/9', width: '100%', borderRadius: '1px'}}\n      >\n        <Flex align=\"center\" direction=\"column\" height=\"fill\" justify=\"center\">\n          <Spinner muted />\n          <Box marginTop={3}>\n            <Text align=\"center\" muted size={1}>\n              Loadingâ€¦\n            </Text>\n          </Box>\n        </Flex>\n      </Card>\n    </div>\n  )\n}\n","import React, {lazy, memo, Suspense} from 'react'\nimport {type InputProps} from 'sanity'\n\nimport {isMuxInputProps} from '../util/asserters'\nimport {type Config} from '../util/types'\nimport ErrorBoundaryCard from './ErrorBoundaryCard'\nimport {AspectRatioCard, InputFallback} from './Input.styled'\n\nconst Input = lazy(() => import('./Input'))\n\n// eslint-disable-next-line import/no-anonymous-default-export\nexport default (config: Config) =>\n  memo(function FormInput(props: InputProps) {\n    if (isMuxInputProps(props)) {\n      return (\n        <AspectRatioCard>\n          <ErrorBoundaryCard schemaType={props.schemaType}>\n            <Suspense fallback={<InputFallback />}>\n              <Input config={config} {...props} />\n            </Suspense>\n          </ErrorBoundaryCard>\n        </AspectRatioCard>\n      )\n    }\n    return props.renderDefault(props)\n  })\n","import React, {lazy, memo} from 'react'\nimport {PreviewLayoutKey, PreviewProps} from 'sanity'\n\nimport {isMuxInputPreviewProps} from '../util/asserters'\nimport {AspectRatioCard} from './Input.styled'\n\nconst Preview = lazy(() => import('./Preview'))\n\nexport default memo(function FormPreview(props: PreviewProps<PreviewLayoutKey>) {\n  if (isMuxInputPreviewProps(props)) {\n    return (\n      <AspectRatioCard>\n        {/* @ts-expect-error */}\n        <Preview {...props} />\n      </AspectRatioCard>\n    )\n  }\n  return props.renderDefault(props)\n})\n","import {definePlugin} from 'sanity'\n\nimport createFormInput from './components/FormInput'\nimport FormPreview from './components/FormPreview'\nimport {type Config} from './util/types'\n\nexport const defaultConfig: Config = {\n  mp4_support: 'none',\n}\n\nexport const muxInput = definePlugin<Partial<Config> | void>((userConfig) => {\n  const config: Config = {...defaultConfig, ...userConfig}\n  const InputComponent = createFormInput(config)\n  return {\n    name: 'mux-input',\n    form: {\n      components: {\n        input: InputComponent,\n        preview: FormPreview,\n      },\n    },\n    schema: {\n      types: [\n        {\n          name: 'mux.video',\n          type: 'object',\n          title: 'Video asset reference',\n          fields: [\n            {\n              title: 'Video',\n              name: 'asset',\n              type: 'reference',\n              weak: true,\n              to: [{type: 'mux.videoAsset'}],\n            },\n          ],\n        },\n        {\n          name: 'mux.videoAsset',\n          type: 'object',\n          title: 'Video asset',\n          fields: [\n            {\n              type: 'string',\n              name: 'status',\n            },\n            {\n              type: 'string',\n              name: 'assetId',\n            },\n            {\n              type: 'string',\n              name: 'playbackId',\n            },\n            {\n              type: 'string',\n              name: 'filename',\n            },\n            {\n              type: 'number',\n              name: 'thumbTime',\n            },\n          ],\n        },\n      ],\n    },\n  }\n})\n"],"names":["isMuxInputProps","props","_a","isObjectInputProps","schemaType","type","name","isMuxInputPreviewProps","_b","cacheNs","muxSecretsDocumentId","ErrorBoundaryCard","children","push","pushToast","useToast","errorRef","useRef","ErrorBoundary","didCatch","error","reset","useErrorBoundary","onDidCatch","err","errorInfo","console","group","toString","groupCollapsed","groupEnd","stack","log","componentStack","status","title","description","Flex","align","jsxs","Inline","space","jsx","Button","padding","fontSize","style","transform","mode","text","onClick","current","scrollIntoView","behavior","scrollMode","block","handleRetry","useCallback","clear","Card","ref","paddingX","height","shadow","overflow","justify","Grid","columns","gap","Heading","as","message","tone","radius","Text","ErrorBoundaryCard$1","memo","AspectRatioCard","styled","_templateObject","_taggedTemplateLiteral","InputFallback","sizing","aspectRatio","width","borderRadius","direction","Spinner","muted","Box","marginTop","size","Input","lazy","createFormInput","config","FormInput","Suspense","fallback","renderDefault","Preview","FormPreview","defaultConfig","mp4_support","muxInput","definePlugin","userConfig","InputComponent","form","components","input","preview","schema","types","fields","weak","to"],"mappings":"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"}